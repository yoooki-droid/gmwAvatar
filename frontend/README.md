# 前端说明（Vue 3 + Vite）

## 本地启动
```bash
cd frontend
npm install
npm run dev -- --host 0.0.0.0 --port 5174
```

## 页面与路由
1. 列表页：`/`
- 每条新闻支持 `自动播报` 开关。
- 操作仅保留：编辑、删除。
- 右上角“播放”按钮进入调试页。

2. 编辑页：`/editor`、`/editor/:id`
- 字段规则：标题/内容必填；时间/发言人非必填。
- 支持 `AI 生成口播稿与亮点`。
- 页面仅保留 `保存` 按钮。

3. 调试页：`/playback`
- 默认不加载数字人。
- 可手动“加载数字人/不加载数字人”。
- 支持多语言多选播报配置。
- 可打开沉浸式页。

4. 沉浸式页：`/immersive/:id`
- 页面固定 16:9。
- 仅展示数字人与 2 条 Highlights。
- 多语言时按“同一条新闻多语言播完，再切下一条”循环。

## 与后端联动接口
- `GET /api/reports`
- `GET /api/reports/{id}`
- `POST /api/reports`
- `PUT /api/reports/{id}`
- `DELETE /api/reports/{id}`
- `POST /api/reports/generate-preview`
- `POST /api/reports/translate-script`
- `GET /api/reports/playback/queue`
- `POST /api/avatar/token`

说明：
- 播放队列请求支持 `include_audio=true&langs=...`，用于直接获取非中英文的预合成 PCM 音频缓存。
- 页面不再做实时翻译，统一读取后端预翻译/预音频结果。

## 今日更新（2026-02-11）
1. 调试页默认不加载数字人，新增显式加载控制。
2. 调试页语言多选与沉浸式页联动已打通。
3. 加入翻译准备态（Pending），避免语种切换时先播中文。
4. 列表页逻辑切换为“自动播报开关 + 编辑删除”。

## 最新调整（2026-02-11 晚）
1. 调试页参数区按钮拆分：
- `保存配置`
- `加载数字人（当前调试页）`

2. 沉浸式页配置读取：
- 打开沉浸式页时优先读取调试页刚保存的最新配置。

3. 列表页交互：
- 移除状态列与状态筛选。
- 新增“绑定飞书表单”按钮与输入面板（当前只做绑定入口与本地保存）。

4. 自动播报默认值：
- 新建/导入新闻默认不进入播报队列，需手动开启 `auto_play_enabled`。

## 第二轮细化（2026-02-11 晚）
1. 非中文语种必须先完成 AI 翻译，再进行数字人播报。
2. 播报过程中数字人实例保持驻留，不按每条新闻重载。
3. 列表页开关自动播报后，播放页/沉浸式页队列实时同步。
4. 编辑页新增 `上一条`、`下一条`、`保存并开启播报`。
5. 列表页移除顶部标题区，提升单屏可视条目数。
6. 沉浸式页面标题与 Highlights 随当前播报语言同步翻译。
7. 多语言文案改为后端预翻译入库，前端优先读取数据库翻译结果。
8. 新增双渲染模式：
- 中文/英文：`TEXT_RENDER`
- 其它语种：`AUDIO_STREAM_RENDER`（读取后端预合成 PCM）
- 当目标语种音频暂未就绪时，会回退到“同语言文本驱动”，避免队列阻塞
9. 性能优化：
- 队列轮询默认走轻量数据（不带音频大包）
- 当前播报新闻的目标语种音频按需拉取，减少沉浸式页面等待与网络抖动

## 新需求规划（2026-02-12，待开发）
1. 编辑页多语言预审
- 新增语言切换栏。
- 切换语言时自动检查并触发该语言预翻译（若未准备）。
- 在编辑页展示该语言准备状态：`已准备/准备中/失败`。

2. 调试页三模式框架
- 顶部新增三个互斥模式按钮：
  - `实时总结`
  - `轮播会议总结`（当前功能）
  - `会议反思提问`
- 调整会议主题字号（更小），减少视觉干扰。

3. 模式行为边界
- `实时总结`：展示飞书实时会议记录（先做前端占位与状态框架）。
- `轮播会议总结`：保持当前队列播报逻辑不变。
- `会议反思提问`：支持选择单条新闻进入深度反思问答流程（先做交互框架）。

## 新需求落地（2026-02-12）
1. 编辑页
- 已增加多语言预翻译勾选区与语言切换标签。
- 勾选语言后自动准备翻译并回填到当前编辑视图。
- 非中文语言可编辑并单独保存校对结果。

2. 调试页
- 已增加三种顶层模式按钮：实时总结/轮播会议总结/会议反思提问。
- 已增加轮播范围切换：仅当前新闻/循环已开启新闻。
- 会议标题字号已下调。
- 已增加 `保存配置并执行` 按钮：点击后会立即同步到沉浸式页（模式/语言/当前聚焦内容）。

3. 沉浸式页
- 已按后端模式状态渲染并播报对应内容。
- 轮播模式继续支持“同新闻多语言播完再到下一条”。
