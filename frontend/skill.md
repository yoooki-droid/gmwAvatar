---
name: frontend-vue-avatar-player
description: 面向多国会议数字人播报系统的 Vue 前端技能。用于实现运营后台页面、审核编辑流程、发布播报页，以及百度实时数字人 iframe 播放器接入。
---

# 前端技能文档

## 目标
构建 Vue 前端，覆盖运营审核与对外播报两类页面。

## 技术栈
- Vue 3 + Vite
- TypeScript
- Pinia
- Vue Router
- Axios

## 核心页面
1. 会议总结列表页（按状态筛选）。
2. 会议总结编辑/审核页。
3. 数字人调试页（参数调试与连接验证）。
4. 沉浸式播放页（仅数字人 + Highlight，16:9）。

## 关键体验要求
- 支持手动创建与批量导入触发。
- 审核区必须可编辑以下字段：
  - title
  - meeting_time
  - speaker
  - summary_raw
  - script_final
  - highlights_final
- 页面清晰展示状态：Draft / Reviewed / Published。
- 播报页在数字人区域旁展示亮点内容。

## 百度数字人接入
- 采用 iframe 模式。
- 初始化前先向后端请求 token。
- 使用 `TEXT_RENDER` 驱动 `script_final` 播报。
- 使用 `AUDIO_STREAM_RENDER` 驱动非中英文语种的 PCM 音频播报。
- 使用 `new DHIframe('digital-human-iframe')` 绑定 iframe 实例。
- 播报前先判断 `remoteVideoConnected` 与 `wsState.OPEN`，仅在就绪后触发首句播报。
- 支持 `<interrupt></interrupt>` 打断当前播报。
- 必须监听事件：
  - `RENDER_START`
  - `FINISHED`
  - `RENDER_ERROR`
  - `RENDER_INTERRUPTED`
  - `DOWN_SUBTITLE`
- 建议额外监听：
  - `DISCONNECT_ALERT`
  - `TIMEOUT_EXIT`
  - `rtcState.localVideoMuted`
  - `wsState.CLOSING/CLOSED`
- 处理移动端自动播放限制，提供用户交互后解除静音流程。
- 提供“重载数字人 / 卸载数字人”控制能力，便于异常恢复。
- 参考 `ref/云渲染demo (2).zip`，支持参数：
  - `autoChromaKey`
  - `videoBg`
  - `ttsPer`
  - `cp-ttsSample`
  - `cp-preAlertSec`
  - `cp-positionV2`

## 页面行为约束（新增）
1. 列表页移除“小眼睛查看”入口，仅保留编辑/删除和自动播报开关。
2. 顶部“播放”按钮直接进入调试播放页。
3. 调试播放页提供“打开沉浸式播放页”按钮，新窗口打开。
4. 沉浸式播放页仅展示数字人与 Highlight，不展示参数编辑和其他功能区。
5. 沉浸式播放页按自动播报队列循环，支持同一条新闻多语言连续播报。

## 状态管理建议
- `reportStore`：负责 CRUD、审核、发布。
- `avatarStore`：负责播放器状态与事件数据。
- 发布操作必须以服务端返回为准，不做激进乐观更新。

## 今日实现对齐（2026-02-11）
1. 编辑页规则
- 标题/内容必填，时间/发言人非必填。
- 页面仅保留 `保存` 按钮。
- `AI 生成口播稿与亮点` 按钮直接调用后端 AI 接口。

2. 调试页规则
- 默认不加载数字人，增加“加载数字人/不加载数字人”控制。
- 增加语言多选（中/英/粤/日/印尼/马来/印地）。
- 未准备好目标语种文案时显示 Pending，不先播中文。

3. 沉浸式页规则
- 打开时继承调试页当前语言选择。
- 若勾选多语言，播报顺序为“同一新闻多语言 -> 下一新闻 -> 循环”。
- UI 对齐参考图并固定 16:9，水印使用 `TPCNEWS`。

## 新增规则（2026-02-11 晚）
1. 调试页参数区按钮拆分为“保存配置”和“加载数字人（当前调试页）”。
2. 沉浸式页打开时必须优先读取调试页最新保存配置。
3. 列表页移除状态相关展示，新增“绑定飞书表单”入口弹层。
4. 新增新闻默认 `auto_play_enabled=false`，手动开启后才进入播报队列。

## 第二轮规则（2026-02-11 晚）
1. 非中文播报必须先调用 Azure AI 翻译，禁止直接使用中文原文驱动其它语种。
2. 连续播报期间保持同一数字人实例，不在每条新闻完成后重载。
3. 列表开关变更需实时广播到播放页与沉浸式页并刷新队列。
4. 编辑页增加上一条/下一条/保存并开启播报的快捷流。

## 第三轮规则（2026-02-11 晚）
1. 多语言文案与 Highlights 由后端预翻译入库，前端不做实时翻译。
2. 中文/英文继续使用文字驱动，粤语等语种改为音频流驱动。
3. 若目标语种音频未就绪，优先等待；若仍未就绪则回退为同语言文本驱动，不回退中文。

## 质量要求
- 为编辑页校验编写组件测试。
- 为发布到播报链路编写 E2E 测试。
- 为播放器初始化/播报失败提供错误态 UI。
- 列表与播报页提供加载骨架屏。

## 部署要点（阿里云轻量服务器）
- Vite 打包后由 Nginx 托管静态资源。
- 接口地址通过 `VITE_API_BASE_URL` 配置。
- Hash 资源使用长缓存，`index.html` 禁缓存。
