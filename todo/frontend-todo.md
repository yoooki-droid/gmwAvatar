# 前端 Todo（系统架构版）

## 目标
构建运营后台与前端播放页，替换静态人物为百度曦灵数字人，并实现“发布即播报 + Highlight 展示”。

## 迭代 1（MVP）
1. 运营后台（参考 `ref/News Anchor Dashboard UI`）
- [ ] 列表页：状态、标题、发言人、日期、操作列
- [ ] 编辑页：标题、时间、发言人、原文输入
- [ ] AI 输出区：口播稿与 Highlight 可编辑
- [ ] 动作：生成、保存草稿、发布

2. 播放页（`frontend/`）
- [ ] 使用百度曦灵 iframe 替换“男生图片”
- [ ] 接入 `GET /api/reports/published/latest` 拉取发布内容
- [ ] 展示 `script_final` 与 `highlights_final`
- [ ] 支持“开始播报”并调用 `TEXT_RENDER`
- [ ] 监听播报状态与字幕
- [ ] 调试页增加“打开沉浸式播放页”按钮（新窗口）
- [ ] 沉浸式播放页按 16:9 实现，样式对齐 `ref/沉浸式新闻播放页.jpg`
- [ ] 沉浸式播放页只保留“数字人 + Highlight”，移除调试与编辑区
- [ ] 沉浸式播放页实现单条新闻循环播报

3. 数字人控制能力
- [ ] 静音/取消静音
- [ ] 打断播报（`<interrupt></interrupt>`）
- [ ] 重载/卸载数字人
- [ ] 连接状态提示（ws/rtc）
- [ ] 接入新版 demo 参数（`autoChromaKey/videoBg/cp-positionV2` 等）

4. 工程基础
- [ ] 路由与页面拆分（CMS 与播放页）
- [ ] 状态分层（reportStore/avatarStore）
- [ ] 请求层统一错误处理

5. 质量保障
- [ ] 组件测试：编辑页校验、发布按钮可用性
- [ ] E2E：发布后在播放页可见并可播报
- [ ] 空态/错误态/加载态补齐

## 迭代 2（增强）
1. 导入体验增强
- [ ] 文件导入进度与错误明细展示
- [ ] API 导入任务状态展示（预留）

2. 运营体验增强
- [ ] 审核历史与版本差异视图
- [ ] 发布保护（二次确认）

3. 播报稳定性增强
- [ ] 播报失败重试
- [ ] 超时重连

## 架构评审补充（已对齐你的决策）
1. [ ] 验收范围先覆盖常规浏览器（不含微信内置浏览器）
2. [ ] 页面显示中国时区时间
3. [ ] 删除后前端列表直接移除，不提供回收站入口

## 今日进展（2026-02-11）
1. 已完成
- [x] 列表页接入自动播报开关并可实时保存
- [x] 列表页操作列精简为编辑/删除
- [x] 顶部播放按钮直达调试页
- [x] 编辑页字段规则与保存逻辑按新需求完成
- [x] AI 生成按钮可用并回填口播稿和 2 条亮点
- [x] 调试页默认不加载数字人，支持手动加载/卸载
- [x] 调试页支持多语言多选
- [x] 沉浸式页继承调试页语言并多语言循环播报
- [x] 沉浸式页水印更新为 `TPCNEWS`

2. 待优化
- [ ] 沉浸式页空白/超时场景的恢复提示进一步增强
- [ ] 播放日志面板（用于你后续排查 token/网络问题）

3. 新增待办（2026-02-11 晚）
- [ ] 调试页“保存配置/加载数字人”按钮拆分并验证
- [ ] 沉浸式页优先读取调试页最新配置
- [ ] 列表页新增“绑定飞书表单”按钮与绑定面板
- [ ] 列表页移除状态列和状态筛选

4. 第二轮待办（2026-02-11 晚）
- [x] 非中文语种改为“后端预翻译 + 音频流驱动播报”
- [ ] 播报链路去除每条新闻重载数字人的行为
- [ ] 列表开关变更实时同步到沉浸式队列
- [ ] 编辑页新增上一条/下一条/保存并开启播报
- [ ] 列表页移除标题区，提升可视高度

5. 新增进展（2026-02-11 晚）
- [x] 播放/沉浸式页接入双渲染模式：`TEXT_RENDER` + `AUDIO_STREAM_RENDER`
- [x] 沉浸式页标题与 Highlights 跟随当前播报语言切换
- [x] 队列轮询改为轻量拉取，音频按当前新闻/当前语言按需拉取
- [ ] 粤语发音质量仍需结合具体 TTS 模型继续调优

6. 新需求待办（2026-02-12）
- [ ] 编辑页新增多语言切换栏与翻译准备状态显示
- [ ] 切换语言时自动触发该语言预翻译并回填展示
- [ ] 调试页新增三种顶层模式按钮（实时总结/轮播会议总结/会议反思提问）
- [ ] 调试页会议主题字号下调与模式状态提示
- [ ] `实时总结`模式前端展示框架与飞书数据占位渲染
- [ ] `会议反思提问`模式前端交互框架与单条新闻选择器

7. 新需求完成（2026-02-12）
- [x] 编辑页新增多语言切换栏与翻译准备状态显示
- [x] 切换语言自动触发预翻译并支持语言视图校对
- [x] 调试页新增三种顶层模式按钮
- [x] 调试页会议主题字号下调与模式状态提示
- [x] `实时总结`模式前端展示框架联调完成
- [x] `会议反思提问`模式前端交互框架联调完成

8. 新增待办（飞书会议链接导入）
- [x] 列表页“绑定飞书表单”改为“绑定飞书会议链接”
- [x] 绑定面板新增导入参数（回溯天数/是否自动生成/是否自动开启播报）
- [x] 新增 API 调用：`POST /api/reports/import/feishu-meeting`
- [x] 导入完成后自动刷新列表并展示导入结果明细

9. 新增进展（调试页实时总结）
- [x] 实时总结模式新增“绑定飞书会议”按钮
- [x] 调试页新增飞书链接弹层（输入会议链接/回溯天数）
- [x] 支持在调试页执行飞书诊断与导入，并展示结果
- [x] 实时总结模式改为数字人静默待机（不自动播报、不手动播报）
- [x] 会议中无正式小结时展示占位实时记录/增量草稿
- [x] 实时小结新增动画：增量出现 + 新旧内容淡入淡出

10. 新增进展（2026-02-12 晚，实时绑定一致性）
- [x] 实时总结读取接口支持携带 `report_id`，避免读到“最新新闻”而非绑定会议
- [x] 调试页绑定飞书导入后记录 `report_id`，实时拉取与保存模式均使用该 `report_id`
- [x] 沉浸式实时页按模式配置的 `selected_report_id` 拉取数据，和调试页保持一致
- [x] 实时模式移除占位假文案，仅展示章节内容；无章节时显示空态

11. 新阶段任务（2026-02-13，统一反思播报链路）
- [ ] 编辑页新增“一键生成全部”动作（总结/亮点/反思 + 多语言准备）
- [ ] 编辑页多语言视图支持反思内容校对与保存
- [ ] 调试页反思模式只读已缓存反思，不再临时生成
- [ ] 反思模式多语言切换与总结模式保持一致（同语言展示同语言播报）

12. 新阶段任务（2026-02-13，会后拉齐体验）
- [ ] 列表页新增来源状态展示：`未就绪/拉取中/已拉齐/生成失败`
- [ ] 新增多维表绑定面板（配置表格链接/手动同步）
- [ ] 新增最近同步时间与同步结果提示
- [ ] 实时模式无章节数据时提供明确空态说明（不展示占位假文案）
