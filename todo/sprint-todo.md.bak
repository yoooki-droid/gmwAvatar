# 多国会议数字人播报项目总控迭代待办

## 文档索引
- 后端专项：`todo/backend-todo.md`
- 前端专项：`todo/frontend-todo.md`
- 数据库专项：`todo/dba-todo.md`
- 需求基线：`docs/require.md`
- 百度数字人接入：`baiduavatar.skills`

## 已确认决策（2026-02-11）
1. 发布模型：允许多条新闻并行 `published`
2. 时区策略：统一中国时区 `Asia/Shanghai`
3. 生成策略：仅使用 AI，不做降级方案
4. 权限策略：当前后台单人，不做权限系统
5. 删除策略：硬删除，不做回收站恢复
6. 浏览器范围：先做常规浏览器，不纳入微信内置浏览器
7. 导入路线：先文件导入，再对接 API 导入（先预留接口）

## 迭代 1（MVP，P0）

### 业务目标
- 运营可在后台完成创建、生成、编辑、保存草稿、发布。
- 播放页可显示百度曦灵数字人并播报已发布口播稿。
- 播放页同步展示最终 Highlight。

### 后端里程碑
1. [ ] 完成核心 API：列表、详情、新建、更新、删除（硬删除）
2. [ ] 完成生成接口与发布接口强校验
3. [ ] 完成 `GET /api/reports/published/latest`
4. [ ] 完成 `POST /api/avatar/token`
5. [ ] 完成文件导入接口 `POST /api/reports/import/file`
6. [ ] 预留 API 导入接口 `POST /api/reports/import/source`

### 前端里程碑
1. [ ] 完成 CMS 列表页和编辑页（参考 `ref/News Anchor Dashboard UI`）
2. [ ] 完成调试播放页（仅参数调试 + 状态）
3. [ ] 完成沉浸式播放页（16:9，数字人 + Highlight）
4. [ ] 完成“小眼睛 -> 调试页 -> 沉浸式页”打开链路
5. [ ] 完成单条新闻循环播报
6. [ ] 完成空态/错误态/加载态

### DBA 里程碑
1. [ ] 完成首版表结构与索引
2. [ ] 完成中国时区统一策略
3. [ ] 完成备份、恢复与账号权限基线
4. [ ] 确认删除硬删除策略与数据保留策略

### 运维里程碑（阿里云轻量服务器）
1. [ ] 完成 Python / MySQL / Nginx / Node 环境初始化
2. [ ] 完成 Nginx 反代与域名接入（`adty.octaveliving.com`）
3. [ ] 完成 HTTPS 证书配置和强制跳转
4. [ ] 完成进程守护、日志轮转、监控告警

## 迭代 2（增强，P1）

### 增强目标
- API 导入正式接入
- 生成质量与稳定性增强
- 审计与可观测性增强

### 后端增强
1. [ ] API 导入任务化接入
2. [ ] Azure LLM 服务抽象与 Prompt 版本化
3. [ ] 审核日志与发布版本快照
4. [ ] 指标与告警完善

### 前端增强
1. [ ] 文件导入与 API 导入任务状态可视化
2. [ ] 审核历史和差异对比
3. [ ] 播报失败重试与重连

### DBA 增强
1. [ ] 审计表与版本表落地
2. [ ] 慢查询治理与索引优化
3. [ ] 数据归档与容量治理

## 完成定义（全团队）
- [ ] 功能自测通过，关键流程有自动化测试
- [ ] 接口文档与部署文档同步更新
- [ ] 生产密钥不入库，日志无敏感信息
- [ ] 在阿里云轻量服务器可稳定运行

## 今日进展（2026-02-11）
1. 已完成
- [x] 列表页自动播报开关（`auto_play_enabled`）联调完成
- [x] 列表页移除“查看调试”入口，仅保留编辑/删除
- [x] 顶部“播放”按钮直达调试页
- [x] 编辑页改为“标题/内容必填，时间/发言人非必填”
- [x] 编辑页仅保留保存按钮
- [x] Azure AI 生成口播稿与 2 条亮点
- [x] 调试页默认不加载数字人，支持手动加载/卸载
- [x] 多语言播报与沉浸式页面联动
- [x] 沉浸式页按“同新闻多语言 -> 下一新闻”循环
- [x] 数据库存储路径修复，避免多库错连
- [x] 多语言改为后端预翻译入库，前端不再实时翻译
- [x] 播报队列支持按语言返回渲染模式（text/audio）
- [x] 非中英文新增预合成音频缓存（PCM）与音频流播报能力
- [x] 沉浸式页标题/Highlights跟随当前播报语言切换
- [x] 已补充 3 条夜间验收测试新闻并加入播报队列（`夜间验收测试新闻1-3`）

2. 进行中
- [ ] 沉浸式页在不同网络环境下的百度连接超时稳定性优化
- [ ] 语音模型选型与粤语发音质量优化（需验证具体 TTS 部署）
- [ ] AI 接口失败重试与更细化错误提示

## 2026-02-12 新增规划（待开发）
1. 编辑页多语言预审
- [ ] 新增语言切换栏与语言状态标记（已准备/准备中/失败）
- [ ] 切换语言自动触发该语言预翻译（若未准备）
- [ ] 支持人工复核当前语言结果并保存

2. 调试页模式化改造
- [ ] 新增三种顶层模式按钮：`实时总结`、`轮播会议总结`、`会议反思提问`
- [ ] 调整会议主题字号与模式状态展示
- [ ] `轮播会议总结`模式兼容现有播报链路

3. 后端接口规划落地
- [ ] 新增翻译准备状态查询接口与按语言触发预翻译接口
- [ ] 预留飞书实时记录接口契约（实时总结模式使用）
- [ ] 预留会议反思问答接口契约（反思提问模式使用）

## 2026-02-12 开发完成
1. 编辑页多语言预审
- [x] 语言切换与预翻译准备状态
- [x] 语言内容人工校对保存

2. 调试页模式化改造
- [x] 三种顶层模式切换按钮
- [x] 轮播范围切换（仅当前/循环）
- [x] 会议标题字号下调

3. 后端接口落地
- [x] 翻译查询/准备/更新接口
- [x] 播放模式查询/更新接口
- [x] 实时总结占位接口与反思问答接口

## 2026-02-12 新增迭代（飞书会议链接导入）
1. [x] 后端新增会议链接导入接口：`POST /api/reports/import/feishu-meeting`
2. [x] 接入飞书会议+妙记链路：meeting_no -> meeting_id -> minute -> transcript
3. [x] 落库幂等：同 minute_token 走更新，避免重复导入
4. [x] 列表页绑定面板改造为“会议链接绑定并导入”
5. [x] 导入结果可视反馈（成功/更新/失败）
6. [x] 新增会议信息预查询接口：`POST /api/reports/import/feishu-meeting/inspect`
